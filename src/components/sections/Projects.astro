---
import Section from "../Section.astro";
import { Icon } from "astro-icon/components";
import { projects } from "@cv";

// Función para cargar imágenes de una carpeta dada
function getImagesFromFolder(folderPath) {
  // Importa todos los archivos dentro de la carpeta
  const images = import.meta.glob(`/src/assets/projects/${folderPath}/*.{png,jpg,jpeg,webp}`, {
    eager: true,
    import: "default"
  });

  // Devuelve la lista ordenada por nombre de archivo
  return Object.values(images).sort();
}
---

<Section className={Astro.props.className} title="Projects">
  <div class="grid grid-cols-1 gap-3 md:grid-cols-2 print:flex print:flex-col">
    {
      projects.map((project) => {
        const { url, description, highlights, name, isActive, github, imageFolder } = project;
        const images = imageFolder ? getImagesFromFolder(imageFolder) : [];

        return (
          <div
            role="contentinfo"
            class="project-container grid-span-1 group relative flex min-h-80 flex-col overflow-hidden rounded-md bg-skin-button-muted/50 p-5 shadow-sm ring-1 ring-skin-muted"
          >
            {/* Header */}
            <div class="relative z-10 flex items-center justify-between space-x-[10px]">
              <div class="flex items-center gap-2">
                <Icon name="mdi:folder-outline" class="size-4" />
                <div class="flex items-center gap-[6px]">
                  {isActive ? (
                    <a
                      class="group flex items-center gap-[6px] text-lg decoration-dotted underline-offset-[5px] hover:text-skin-hue hover:underline"
                      href={url}
                      target="_blank"
                    >
                      {name}
                      <span class="text-skin-hue transition ease-linear group-hover:-translate-y-0.5 group-hover:translate-x-0.5">
                        <Icon name="ri:arrow-up-line" class="rotate-45" />
                      </span>
                    </a>
                  ) : (
                    <span>{name}</span>
                  )}
                </div>
              </div>

              {github && (
                <a
                  href={github}
                  target="_blank"
                  rel="noopener"
                  class="opacity-75 transition duration-100 hover:scale-125 hover:opacity-100"
                >
                  <Icon name="mdi:github" width={24} height={24} />
                </a>
              )}
            </div>

            {/* Description */}
            <p class="relative z-10 py-3 text-sm text-skin-base">
              {description}
            </p>

            {/* Highlights */}
            <ul class="relative z-10 mt-1 text-sm text-skin-inverted">
              {highlights.map((h) => <li>{h}</li>)}
            </ul>

            {/* Reel de imágenes */}
            {images.length > 0 && (
              <div class="relative z-10 mt-4 flex overflow-x-auto gap-3 pb-2 scrollbar-hide">
                {images.map((img) => (
                  <a data-fancybox={`project-${name}`} href={img}>
                    <img
                      src={img}
                      alt={name}
                      class="h-40 rounded-lg object-cover flex-shrink-0"
                    />
                  </a>
                ))}
              </div>
            )}
          </div>
        );
      })
    }
  </div>
</Section>

<script>
  import { Fancybox } from "@fancyapps/ui";
  Fancybox.bind('[data-fancybox]', { hideScrollbar: false });
</script>

<style>
  ul {
    @apply ml-4 list-disc space-y-1;
  }
  ul li {
    @apply text-skin-muted;
  }

  /* Ocultar scroll bar horizontal en el reel */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
